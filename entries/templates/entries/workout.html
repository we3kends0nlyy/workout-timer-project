{% extends "entries/base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown Timer</title>
    <style>
        /* Center the countdown and exercise text vertically and horizontally */
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; /* Adjust this value to center vertically */
            flex-direction: column; /* Display elements vertically */
        }

        /* Style the countdown and exercise text */
        .text {
            font-size: 100px; /* Adjust the font size as needed */
            font-weight: bold;
            text-align: center;
            margin-bottom: 50px;
        }

        /* Style the exercise text */
        .exercise-text {
            font-size: 50px; /* Adjust the font size as needed */
            margin-bottom: 20px;
        }

        /* Style the timer text */
        .timer-text {
            font-size: 30px; /* Adjust the font size as needed */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text" id="countdown">5</div>
        <div class="container" id="exercise-container" style="display: none;">
            <div class="exercise-text" id="exercise-name">Exercise Name</div>
            <div class="timer-text" id="total-time">Total Time Remaining: 00:00</div>
            <div class="timer-text" id="exercise-timer">Exercise Time Remaining: 00:00</div>
        </div>
    </div>

    <script>
        // JavaScript code for countdown
        const countdownElement = document.getElementById('countdown');
        let countdown = 5; // Initial countdown value

        // Function to update the countdown element
        function updateCountdown() {
            countdownElement.textContent = countdown;
            countdown--;

            // Stop the countdown when it reaches 0
            if (countdown < 0) {
                clearInterval(countdownInterval);
                countdownElement.textContent = "Let's go!";
                setTimeout(function () {
                    countdownElement.style.display = 'none'; // Hide the countdown text
                    startExerciseDisplay(); // Start displaying exercises
                }, 2000); // Wait for 2 seconds before removing "Let's go!" text
            }
        }

        // Call the updateCountdown function every second
        const countdownInterval = setInterval(updateCountdown, 1000);

        // Function to format time as mm:ss
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(remainingSeconds).padStart(2, '0');
            return `${formattedMinutes}:${formattedSeconds}`;
        }

        // JavaScript code for displaying exercises
        function startExerciseDisplay() {
            const exerciseContainer = document.getElementById('exercise-container');
            exerciseContainer.style.display = 'block';

            // Fetch exercise data from Django view
            fetch('/get-exercise-data/') // Update the URL to match your Django URL
                .then(response => response.json())
                .then(data => {
                    const exerciseData = data.exerciseData;

                    let currentIndex = 0;
                    let totalTime = exerciseData.reduce((total, exercise) => total + exercise.time, 0);
                    let currentTime = totalTime;

                    function displayExercise() {
                        if (currentIndex < exerciseData.length) {
                            const exerciseNameElement = document.getElementById('exercise-name');
                            const exerciseTimeElement = document.getElementById('exercise-time');
                            const totalTimeElement = document.getElementById('total-time');
                            const exerciseTimerElement = document.getElementById('exercise-timer');

                            const exercise = exerciseData[currentIndex];
                            exerciseNameElement.textContent = `Exercise: ${(exercise.exercise)}`;
                            totalTimeElement.textContent = `Total Time Remaining: ${formatTime(currentTime)}`;
                            exerciseTimerElement.textContent = `Exercise Time Remaining: ${formatTime(exercise.time)}`;

                            const exerciseInterval = setInterval(function () {
                                exercise.time--; // Decrease the time for the current exercise
                                currentTime--; // Decrease the total time remaining
                                exerciseTimerElement.textContent = `Exercise Time Remaining: ${formatTime(exercise.time)}`;
                                totalTimeElement.textContent = `Total Time Remaining: ${formatTime(currentTime)}`;


                                if (exercise.time <= 0) {
                                    clearInterval(exerciseInterval);
                                    currentIndex++;
                                    if (currentIndex < exerciseData.length) {
                                        totalTimeElement.textContent = `Next exercise/break loading...Get in position!!`;
                                        setTimeout(displayExercise, 5000);
                                    } else {
                                        // All exercises have been displayed
                                        exerciseNameElement.textContent = "Workout complete! Great job! You are strong, resilient, and I admire the way you grind through adversity! I hope to see you soon!";
                                        exerciseTimeElement.textContent = "";
                                    }
                                }
                            }, 1000); // Update timer every second
                        }
                    }

                    displayExercise(); // Start displaying exercises
                });
        }

    </script>
</body>
</html>

{% endblock content %}